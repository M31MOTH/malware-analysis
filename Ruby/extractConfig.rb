# extractConfig.rb by Josh Grunzweig 9-30-2012
#
# =Synopsis
#
# This is a simple Ruby script that is designed to pull out, or extract, the 
# configuration from an Android FinSpy sample.
#
# The configuration file is piped to STDOUT, but it is of course trivial to 
# have it sent to a file instead.
#
# Example: ruby extractConfig.rb finSpy.apk > config.dat
#
# Once the configuration has been extracted, it can be manipulated in a hex
# editor, or parsed using the accompanying parseConfig.rb Ruby script.
#

require 'base64'

file = ARGV.shift
unless file
  puts "Usage: extractConfig.rb <finspy_sample>"
  exit
end

f = File.new(file, 'rb')
fd = f.read
str = fd.scan(/PK\x01\x02.{32}(.{6})(.{4}assets\/Configurations\/dumms\d+\.dat)/m).collect{|x| x[0].to_s}.join
str.gsub!("\u0000",'')
puts Base64.decode64(str)
f.close
